# 📄 Java 聊天系统文档

> **项目名称：WS-Test（WebSocket 测试聊天系统）**  
> **开发语言：Java 21**  
> **适用环境：仅在 Java 21 上测试，未验证其他版本兼容性**

---

## 🧩 一、项目概述

本项目是一个基于 TCP 的简单图形化聊天系统，包含一个服务器端和一个客户端。用户可以通过客户端连接到服务器，并进行公共消息发送、私信交流以及查看在线用户列表。

### ✅ 功能特点：

- 支持多用户同时在线
- 实时接收并显示聊天信息
- 显示当前在线用户列表
- 支持私信功能（点击用户名自动填充 `/msg` 命令）
- 图形界面友好，使用 Swing 构建
- 简单的错误处理机制（如用户名重复）

---

## 📁 二、目录结构说明

```bash
.
├── server.properties              # 配置文件，用于服务器启动参数
├── src/
│   ├── client/
│   │   └── Client.java            # 客户端主程序
│   ├── META-INF/
│   │   └── MANIFEST.MF            # JAR 包清单文件
│   └── server/
│       └── Server.java            # 服务器主程序
└── WS-test.iml                    # IntelliJ IDEA 项目配置文件
```

---

## 🛠️ 三、技术栈与依赖

- **语言版本**：Java 21（必须使用 JDK 21 编译运行）
- **图形库**：Swing
- **网络通信**：Socket + DataInputStream/DataOutputStream
- **线程管理**：Thread + AtomicBoolean
- **UI 布局**：FlowLayout, BorderLayout, JSplitPane, JScrollPane

> ⚠️ 注意：该项目未使用 Maven 或 Gradle 等构建工具，采用的是标准 Java SE 工程结构。

---

## 🔌 四、服务器端说明 `Server.java`

### 📌 主要功能：

- 启动 TCP 服务器监听指定端口
- 接收多个客户端连接
- 维护在线用户列表
- 广播消息给所有在线用户
- 处理私信请求（格式为 `/msg 用户名 内容`）
- 检查用户名是否重复

### ⚙️ 配置文件 `server.properties`

该文件用于配置服务器启动参数：

```properties
# 服务器监听端口号
port=8000
```

> 如果不存在该文件或读取失败，默认使用端口 `8000`。

### 📦 类结构说明：

- `Server`：主类，负责启动服务器、监听客户端连接。
- 使用 `ClientHandler` 内部类处理每个客户端连接。
- 使用 `ConcurrentHashMap` 存储在线用户及对应的输出流。

---

## 💬 五、客户端说明 `Client.java`

### 📌 主要功能：

- 提供图形界面供用户输入用户名、IP 和端口
- 支持连接/断开服务器
- 发送公共消息或私信
- 接收并显示服务器广播的消息
- 实时更新在线用户列表
- 支持双击清空选中用户，点击插入 `/msg` 命令

### 📐 界面布局说明：

- **顶部面板**：用户名、IP 地址、端口、连接按钮
- **中间区域**：
  - 左侧：聊天记录区（只读）
  - 右侧：在线用户列表（可点击插入私信命令）
- **底部面板**：消息输入框 + 发送按钮

### 📎 控件状态控制：

- 连接前：可编辑用户名、IP、端口，发送按钮禁用
- 连接后：锁定配置，发送按钮启用
- 断开后：恢复初始状态

---

## 🧪 六、编译与运行指南

### ✅ 开发建议

- **IDE 推荐**：IntelliJ IDEA / Eclipse
- **JDK 版本要求**：JDK 21
- **编码格式**：UTF-8

### 🧱 编译步骤（手动方式）

#### 1. 编译服务器端

```bash
javac -d out src/server/Server.java
```

#### 2. 编译客户端

```bash
javac -d out src/client/Client.java
```

### ▶️ 启动服务器

```bash
cd out
java server.Server
```

> 默认监听端口 `8000`，可在 `server.properties` 中修改。

### ▶️ 启动客户端

```bash
cd out
java client.Client
```

> 输入用户名、服务器 IP 和端口，点击“连接”即可加入聊天室。

---

## 🧾 七、协议说明（客户端与服务端交互）

| 类型 | 协议格式 |
|------|----------|
| **用户名注册** | 客户端首次发送字符串即为用户名 |
| **普通消息** | `[username]: message` |
| **私信消息** | 以 `[PRIVATE]` 开头，如：`[PRIVATE] user 私信内容` |
| **用户列表协议** | 以 `[USER_LIST]` 开头，后面紧跟逗号分隔的用户名列表 |
| **错误提示** | 如用户名冲突返回 `[ERROR] 用户名已存在！` |

---

## 🧪 八、测试建议

### ✅ 正常流程测试

1. 启动服务器
2. 启动第一个客户端 A，输入用户名 `A`
3. 启动第二个客户端 B，输入用户名 `B`
4. A 发送消息 `Hello!`，B 应收到 `[A]: Hello!`
5. B 点击用户列表中的 A，自动填充 `/msg A `，发送一条私信
6. A 应收到来自 B 的私信内容，格式为：`【私信】B: xxxxx`

### ❌ 异常情况测试

- 输入非法端口，应提示“请输入有效的端口号！”
- 不输入用户名直接连接，应提示“请输入用户名和服务器信息！”
- 输入重复用户名，应提示“[ERROR] 用户名已存在！”
- 关闭服务器，客户端应检测到断开连接并提示“服务器断开连接。”

---

## 📦 九、打包成 JAR 文件（推荐）

### 1. 创建 MANIFEST.MF（确保路径正确）

```txt
Manifest-Version: 1.0
Main-Class: client.Client
```

### 2. 打包客户端 JAR

```bash
cd out
jar cfm Client.jar ../src/META-INF/MANIFEST.MF client/*.class
```

### 3. 打包服务器 JAR

```bash
jar cfm Server.jar ../src/META-INF/MANIFEST.MF server/*.class
```

### 4. 运行 JAR 文件（JAR包名请根据实际情况修改）

```bash
java -jar server_v1.3.jar
java -jar slient_v1.3.jar
```

---

## 📌 十、注意事项

- 请确保服务器先于客户端启动。
- 客户端连接失败时会提示“连接服务器失败，请检查网络或服务器是否运行。”
- 当服务器关闭或断开连接时，客户端会自动退出接收线程并释放资源。
- 若需多人测试，请确保在同一局域网内，或通过公网 IP 配置转发。

---

## 🚀 十一、后续扩展建议

1. **增加登录认证机制**
2. **支持表情符号、图片传输**
3. **保存聊天记录至本地或数据库**
4. **实现群聊、频道功能**
5. **使用 SSL/TLS 加密通信**
6. **增加日志记录模块**
7. **使用 WebSocket 替代 Socket，提升实时性**

---

## 📞 十二、联系方式 & 反馈

如果你有任何问题、改进建议或发现 Bug，欢迎联系我！

---

📄 **文档版本：v1.0**  
📅 最后更新时间：2025年6月11日  
👤 作者：SkyDreamLG
